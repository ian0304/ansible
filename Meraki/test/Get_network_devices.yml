---
- name: Get network devices
  hosts: localhost
  gather_facts: false
  tasks:
      - name: Get all devices
        cisco.meraki.devices_info:
          organizationId: 1563867
          networkIds:
            - L_699746792102694192
        register: networkdevices

      - name: Show all devices
        set_fact: 
          devicesn: "{{ networkdevices | json_query('meraki_response[*].serial') | list }}"

      - name: Get management interface info
        cisco.meraki.devices_management_interface_info:
          serial: "{{ devicesn[0] }}"
        register: result

      - name: Show management interface info
        ansible.builtin.debug:
          msg: "{{ result }}"

      - name: Set management interface dns
        cisco.meraki.devices_management_interface:
          state: present
          serial: "{{ devicesn[0] }}"
          wan1:
            staticDns:
              - 8.8.8.8
              - 9.9.9.9

      - name: Get management interface info
        cisco.meraki.devices_management_interface_info:
          serial: "{{ devicesn[0] }}"
        register: result

      - name: Show management interface info
        ansible.builtin.debug:
          msg: "{{ result }}"

